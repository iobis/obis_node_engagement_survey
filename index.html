<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OBIS Nodes Engagement Survey</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- SurveyJS for jQuery -->
  <script src="https://unpkg.com/survey-jquery@1.9.109/survey.jquery.min.js"></script>
  <link href="https://unpkg.com/survey-core@1.9.109/defaultV2.min.css" rel="stylesheet" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    .sv_main {
      max-width: 900px;
      margin: auto;
    }
  </style>
</head>
<body>
  <h2>OBIS Nodes Engagement Survey</h2>
  <div id="surveyContainer"></div>

  <script>
    const roles = [
      "Chair", "Co-chair", "Vice-chair", "Secretary", "Rapporteur", "Coordinator",
      "Facilitator", "Member", "Observer", "Student", "Guest", "Funder",
      "Funded Member", "Advisor", "Supervised Member", "Seconded Member",
      "Embedded Expert", "Hosted Member", "Liaison", "Technical Expert"
    ];

    const orgs = [
      "GBIF", "TDWG", "GEO BON", "GOOS", "ODIS", "UNEP", "IOC", "CBD"
    ];

    const engagementPanel = (org) => ({
      type: "panel",
      name: `panel_${org}`,
      title: `Engagement with ${org}`,
      elements: [
        {
          type: "radiogroup",
          name: `${org}_involved`,
          title: `Do you work with ${org}?`,
          isRequired: true,
          choices: ["Yes", "No"]
        },
        {
          type: "radiogroup",
          name: `${org}_level`,
          visibleIf: `{${org}_involved} = 'Yes'`,
          title: "Which statement best describes your involvement?",
          choices: [
            "I actively interact with this group (participate on committees, receive funding, etc.)",
            "I passively interact with this group (follow news, mailing list, etc.)"
          ]
        },
        {
          type: "matrixdynamic",
          name: `${org}_engagements`,
          title: "Please describe any active engagements",
          visibleIf: `{${org}_involved} = 'Yes'`,
          columns: [
            { name: "group", title: "Name of group/forum", cellType: "text" },
            { name: "role", title: "Description of interaction", cellType: "dropdown", choices: roles }
          ],
          rowCount: 1,
          addRowText: "Add another engagement"
        },
        {
          type: "comment",
          name: `${org}_comments`,
          title: "Any additional comments?"
        }
      ]
    });

    const surveyJSON = {
      title: "OBIS Nodes Engagement Survey",
      showProgressBar: "top",
      pages: [
        {
          name: "basic_info",
          elements: [
            { type: "text", name: "name", title: "Your name", isRequired: true },
            { type: "text", name: "oceanExpertID", title: "OceanExpert ID (if known)" },
            {
              type: "dropdown",
              name: "obisNode",
              title: "OBIS Node Affiliation",
              isRequired: true,
              choices: [
                "OBIS Canada", "OBIS SEAMAP", "OBIS Japan", "OBIS Africa",
                "EurOBIS", "OBIS-USA", "OBIS Chile", "OBIS India"
              ]
              // Will re-enable API loading later
              // choicesByUrl: {
              //   url: "https://api.obis.org/v3/node",
              //   valueName: "institution",
              //   path: "results"
              // }
            }
          ]
        },
        ...orgs.map(engagementPanel),
        {
          name: "other_groups",
          title: "Other Groups",
          elements: [
            {
              type: "matrixdynamic",
              name: "other_engagements",
              title: "Describe interactions with other groups not listed above",
              columns: [
                { name: "group", title: "Name of group/forum", cellType: "text" },
                { name: "role", title: "Description of interaction", cellType: "dropdown", choices: roles }
              ],
              rowCount: 1,
              addRowText: "Add another engagement"
            },
            {
              type: "comment",
              name: "other_comments",
              title: "Any additional comments?"
            }
          ]
        }
      ]
    };

    $(document).ready(function () {
      const survey = new Survey.Model(surveyJSON);

      survey.onComplete.add(function (sender) {
        console.log("Survey results:", sender.data);
        alert("Thank you! Your response has been submitted.");
      });

      $("#surveyContainer").Survey({ model: survey });
    });
  </script>
</body>
</html>
